# 実装計画: RSS Reader

## 概要

本実装計画では、Feedly風RSSリーダーを段階的に構築します。バックエンド（Python + FastAPI + DynamoDB）、フロントエンド（React + TypeScript）、AWS Bedrockを使用したセマンティック検索を実装します。

## タスク

- [ ] 1. プロジェクト構造とインフラストラクチャのセットアップ
  - バックエンド、フロントエンド、インフラストラクチャのディレクトリ構造を作成
  - 必要な依存関係をインストール（pyproject.toml、package.json）
  - AWS CDKプロジェクトを初期化
  - _要件: 8.1, 8.2, 8.6, 12.1_

- [ ] 2. AWS CDKインフラストラクチャの実装
  - [ ] 2.1 DynamoDBスタックを実装
    - テーブル定義とGSIの設定
    - _要件: 12.1, 12.2_

  - [ ] 2.2 Lambda関数スタックを実装
    - Docker Image Functionの定義
    - 環境変数とIAM権限の設定
    - Lambda関数URLの設定
    - _要件: 8.2, 8.3, 12.2, 12.3_

  - [ ] 2.3 EventBridgeスタックを実装
    - フィード取得ジョブ（1時間ごと）
    - 記事削除ジョブ（1日1回）
    - _要件: 8.4, 12.2_

  - [ ] 2.4 フロントエンドスタックを実装
    - S3バケットとCloudFrontディストリビューションの設定
    - _要件: 12.2_

  - [ ] 2.5 CDKデプロイスクリプトを作成
    - 環境別デプロイの設定
    - _要件: 12.4, 12.5_

- [ ] 3. DynamoDBクライアントとデータモデルの実装
- [ ] 3. DynamoDBクライアントとデータモデルの実装
  - [ ] 3.1 DynamoDBクライアントクラスを実装
    - put_item、get_item、query、delete_itemメソッドを実装
    - _要件: 8.5_

  - [ ] 3.2 DynamoDBクライアントのプロパティテストを作成
    - **プロパティ1: フィード登録の永続化**
    - **検証: 要件 1.1**

  - [ ] 3.3 DynamoDBクライアントのユニットテストを作成
    - 基本的なCRUD操作のテスト
    - エラーハンドリングのテスト
    - _要件: 8.5_

- [ ] 4. フィード管理機能の実装
  - [ ] 4.1 FeedServiceクラスを実装
    - add_feed、get_feeds、delete_feed、update_feedメソッドを実装
    - _要件: 1.1, 1.2, 1.3, 1.4_

  - [ ] 4.2 フィード管理のプロパティテストを作成
    - **プロパティ2: フィード削除時のカスケード削除**
    - **検証: 要件 1.2**
    - **プロパティ3: フォルダ分類の保持**
    - **検証: 要件 1.3**
    - **プロパティ4: フィード一覧の完全性**
    - **検証: 要件 1.4**

  - [ ] 4.3 フィード管理のユニットテストを作成
    - 正常系のテスト
    - エッジケースのテスト
    - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 5. チェックポイント - すべてのテストが通過することを確認
- [ ] 5. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 6. RSSフィード取得機能の実装
  - [ ] 6.1 FeedFetcherServiceクラスを実装
    - feedparserを使用してRSSフィードをパース
    - fetch_all_feeds、fetch_feed、parse_feed、save_articlesメソッドを実装
    - _要件: 2.1, 2.2, 2.3, 2.4, 2.5, 10.1_

  - [ ] 6.2 フィード取得のプロパティテストを作成
    - **プロパティ5: フィード取得エラーのハンドリング**
    - **検証: 要件 2.2**
    - **プロパティ6: 記事の冪等性**
    - **検証: 要件 2.3, 2.4**
    - **プロパティ7: 新規記事の未読状態**
    - **検証: 要件 2.5**

  - [ ] 6.3 フィード取得のユニットテストを作成
    - RSS 2.0とAtomフィードのパーステスト
    - エラーハンドリングのテスト
    - _要件: 2.2, 10.1_

- [ ] 7. AWS Bedrockセマンティック検索の実装
  - [ ] 7.1 ImportanceScoreServiceクラスを実装
    - AWS Bedrockクライアントを初期化
    - invoke_bedrock_embeddings、get_embedding、calculate_similarity、calculate_scoreメソッドを実装
    - キーワード埋め込みのキャッシュ機能を実装
    - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

  - [ ] 7.2 重要度スコア計算のプロパティテストを作成
    - **プロパティ20: 重要度スコアの計算**
    - **検証: 要件 7.1**
    - **プロパティ21: スコア計算の加算性**
    - **検証: 要件 7.2**
    - **プロパティ22: 重要度理由の記録**
    - **検証: 要件 7.3, 7.4**

  - [ ] 7.3 重要度スコア計算のユニットテストを作成
    - Bedrockモックを使用したテスト
    - エラーハンドリングのテスト
    - _要件: 7.1, 7.2, 7.3_

- [ ] 8. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 9. 記事管理機能の実装
  - [ ] 9.1 ArticleServiceクラスを実装
    - get_articles、get_article、mark_as_read、mark_as_savedメソッドを実装
    - DynamoDB GSIを使用した時系列順・重要度順のソート
    - _要件: 3.1, 3.2, 3.3, 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3_

  - [ ] 9.2 記事管理のプロパティテストを作成
    - **プロパティ8: 時系列順ソート**
    - **検証: 要件 3.1**
    - **プロパティ9: 重要度順ソート**
    - **検証: 要件 3.2**
    - **プロパティ10: 記事一覧の必須情報**
    - **検証: 要件 3.3**
    - **プロパティ11: 既読/未読の切り替え**
    - **検証: 要件 4.1, 4.2**
    - **プロパティ12: 未読記事フィルタ**
    - **検証: 要件 4.3**
    - **プロパティ13: 既読記事フィルタ**
    - **検証: 要件 4.4**
    - **プロパティ14: 記事保存の切り替え**
    - **検証: 要件 5.1, 5.2**
    - **プロパティ15: 保存記事フィルタ**
    - **検証: 要件 5.3**

  - [ ] 9.3 記事管理のユニットテストを作成
    - ソート機能のテスト
    - フィルタ機能のテスト
    - _要件: 3.1, 3.2, 4.3, 4.4, 5.3_

- [ ] 10. キーワード管理機能の実装
  - [ ] 10.1 KeywordServiceクラスを実装
    - add_keyword、get_keywords、update_keyword、delete_keyword、recalculate_all_scoresメソッドを実装
    - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 7.5_

  - [ ] 10.2 キーワード管理のプロパティテストを作成
    - **プロパティ16: キーワード登録の永続化**
    - **検証: 要件 6.1**
    - **プロパティ17: キーワードの重み設定**
    - **検証: 要件 6.2**
    - **プロパティ18: キーワードの有効化/無効化**
    - **検証: 要件 6.4, 6.5**
    - **プロパティ19: キーワード一覧の完全性**
    - **検証: 要件 6.6**
    - **プロパティ23: 重要度スコアの再計算**
    - **検証: 要件 7.5**

  - [ ] 10.3 キーワード管理のユニットテストを作成
    - デフォルト重みのテスト
    - 再計算機能のテスト
    - _要件: 6.3, 7.5_

- [ ] 11. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 12. 記事削除機能の実装
  - [ ] 12.1 CleanupServiceクラスを実装
    - cleanup_old_articles、delete_articles_by_age、delete_read_articlesメソッドを実装
    - _要件: 11.1, 11.2, 11.3, 11.4_

  - [ ] 12.2 記事削除のプロパティテストを作成
    - **プロパティ24: 古い記事の削除**
    - **検証: 要件 11.1**
    - **プロパティ25: 既読記事の削除**
    - **検証: 要件 11.2**
    - **プロパティ26: 記事削除時のカスケード削除**
    - **検証: 要件 11.4**

  - [ ] 12.3 記事削除のユニットテストを作成
    - 削除条件のテスト
    - カスケード削除のテスト
    - _要件: 11.1, 11.2, 11.4_

- [ ] 13. FastAPI エンドポイントの実装
  - [ ] 13.1 フィード管理エンドポイントを実装
    - POST /api/feeds、GET /api/feeds、DELETE /api/feeds/{feed_id}、PUT /api/feeds/{feed_id}
    - _要件: 1.1, 1.2, 1.4_

  - [ ] 13.2 記事管理エンドポイントを実装
    - GET /api/articles、GET /api/articles/{article_id}、PUT /api/articles/{article_id}/read、PUT /api/articles/{article_id}/save
    - _要件: 3.1, 3.2, 4.1, 4.2, 5.1, 5.2_

  - [ ] 13.3 キーワード管理エンドポイントを実装
    - POST /api/keywords、GET /api/keywords、PUT /api/keywords/{keyword_id}、DELETE /api/keywords/{keyword_id}、POST /api/keywords/recalculate
    - _要件: 6.1, 6.4, 6.5, 6.6, 7.5_

  - [ ] 13.4 ジョブ実行エンドポイントを実装
    - POST /api/jobs/fetch-feeds、POST /api/jobs/cleanup-articles
    - _要件: 2.1, 11.3_

  - [ ] 13.5 APIエンドポイントの統合テストを作成
    - エンドツーエンドのテスト
    - エラーレスポンスのテスト
    - _要件: 1.1, 3.1, 6.1_

- [ ] 14. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 15. Lambda関数とEventBridgeの設定
  - [ ] 15.1 Lambda関数のエントリーポイントを作成
    - FastAPIアプリケーションを起動するmain.pyを作成
    - _要件: 8.2, 8.3_

  - [ ] 15.2 Dockerfileを完成させる
    - AWS Lambda Web Adapterの設定
    - uvを使用した依存関係管理の設定
    - 環境変数の設定
    - _要件: 8.2_

- [ ] 16. フロントエンドの実装
  - [ ] 16.1 APIクライアントを実装
    - axios を使用してバックエンドAPIと通信
    - _要件: 8.7_

  - [ ] 16.2 TanStack Queryフックを実装
    - useFeed、useArticles、useKeywordsフックを作成
    - _要件: 8.9_

  - [ ] 16.3 フィード管理コンポーネントを実装
    - FeedList、FeedFormコンポーネントを作成
    - Chakra UIを使用したUIデザイン
    - _要件: 1.1, 1.2, 1.4_

  - [ ] 16.4 記事一覧コンポーネントを実装
    - ArticleListコンポーネントを作成
    - TanStack TableとChakra UIを使用してテーブル表示
    - 時系列順・重要度順のソート機能
    - 未読/既読、保存フィルタ機能
    - _要件: 3.1, 3.2, 3.3, 4.3, 4.4, 5.3_

  - [ ] 16.5 記事詳細コンポーネントを実装
    - ArticleDetailコンポーネントを作成
    - Chakra UIを使用したレスポンシブデザイン
    - 既読/未読、保存/解除ボタン
    - 重要度スコアと理由の表示
    - _要件: 4.1, 4.2, 5.1, 5.2, 7.3_

  - [ ] 16.6 キーワード管理コンポーネントを実装
    - KeywordList、KeywordFormコンポーネントを作成
    - Chakra UIを使用したフォームデザイン
    - _要件: 6.1, 6.2, 6.4, 6.5, 6.6_

  - [ ] 16.7 フロントエンドのユニットテストを作成
    - コンポーネントのレンダリングテスト
    - ユーザーインタラクションのテスト
    - Chakra UIコンポーネントのテスト
    - _要件: 8.7, 8.8_

- [ ] 17. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 18. CI/CDパイプラインの実装
  - [ ] 18.1 GitHub Actionsワークフローファイルを作成
    - ci.yml（継続的インテグレーション）を作成
    - リンティング、型チェック、テストの自動実行を設定
    - _要件: 13.1, 13.2, 13.4_

  - [ ] 18.2 バックエンドデプロイメントワークフローを作成
    - deploy-backend.ymlを作成
    - Docker イメージのビルドとECRへのプッシュ
    - Lambda関数の更新
    - _要件: 13.6, 13.7_

  - [ ] 18.3 フロントエンドデプロイメントワークフローを作成
    - deploy-frontend.ymlを作成
    - ビルドとS3へのデプロイ
    - CloudFrontキャッシュの無効化
    - _要件: 13.6, 13.7_

  - [ ] 18.4 インフラストラクチャデプロイメントワークフローを作成
    - deploy-infra.ymlを作成
    - CDKを使用したインフラストラクチャの自動デプロイ
    - _要件: 13.6, 13.7_

  - [ ] 18.5 CI/CDパイプラインのプロパティテストを作成
    - **プロパティ27: CI/CDパイプラインの品質ゲート**
    - **検証: 要件 13.3**
    - **プロパティ28: 自動デプロイメントの実行**
    - **検証: 要件 13.6**
    - **プロパティ29: テストカバレッジの維持**
    - **検証: 要件 13.5**
    - **プロパティ30: デプロイメント失敗時の通知**
    - **検証: 要件 13.10**

  - [ ] 18.6 GitHub Secretsとセキュリティ設定
    - AWS認証情報の設定
    - 環境変数の設定
    - IAMポリシーの作成
    - _要件: 13.11_

  - [ ] 18.7 統合テストとヘルスチェックの実装
    - デプロイメント後のヘルスチェック
    - 統合テストの自動実行
    - _要件: 13.8, 13.9_

  - [ ] 18.8 通知システムの設定
    - Slackまたは他の通知システムとの連携
    - デプロイメント成功/失敗の通知
    - _要件: 13.12_

- [ ] 19. デプロイメント設定
  - [ ] 19.1 CDKデプロイメントの実行
    - 開発環境へのデプロイ
    - _要件: 12.4, 12.5_

  - [ ] 19.2 フロントエンドのデプロイスクリプトを作成
    - ビルドとS3へのアップロード
    - CloudFrontキャッシュの無効化
    - _要件: 8.7_

- [ ] 20. 最終チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

## 注意事項

- 各タスクは特定の要件を参照しており、トレーサビリティを確保しています
- チェックポイントタスクで段階的な検証を行い、問題を早期に発見します
- プロパティテストは普遍的な正確性を検証し、ユニットテストは特定の例とエッジケースを検証します
- すべてのテストタスクが必須となっており、包括的なテストカバレッジを確保します
- AWS CDKを使用してインフラストラクチャをコードで管理し、環境の再現性を確保します
- GitHub Actionsを使用したCI/CDパイプラインにより、コード品質の保証と自動デプロイメントを実現します
