# 実装計画: RSS Reader

## 概要

本実装計画では、Feedly風RSSリーダーを段階的に構築します。バックエンド（Python + FastAPI + DynamoDB）、フロントエンド（React + TypeScript）、AWS Bedrockを使用したセマンティック検索を実装します。

## タスク

- [ ] 1. プロジェクト構造とインフラストラクチャのセットアップ
  - バックエンド、フロントエンド、インフラストラクチャのディレクトリ構造を作成
  - 必要な依存関係をインストール（pyproject.toml、package.json）
  - AWS CDKプロジェクトを初期化
  - _要件: 8.1, 8.2, 8.6, 12.1_

- [ ] 2. AWS CDKインフラストラクチャの実装
  - [ ] 2.1 DynamoDBスタックを実装
    - テーブル定義とGSIの設定
    - _要件: 12.1, 12.2_

  - [ ] 2.2 Lambda関数スタックを実装
    - [ ] 2.2.1 Lambda関数の基本定義を実装
      - Docker Image Functionの定義
      - メモリサイズとタイムアウトの設定
      - アーキテクチャの設定
      - _要件: 8.2, 12.2_

    - [ ] 2.2.2 環境変数とIAM権限の設定を実装
      - DynamoDB、Bedrockへのアクセス権限
      - 基本環境変数の設定（テーブル名、リージョン等）
      - _要件: 8.3, 12.3_

    - [ ] 2.2.3 認証関連の環境変数設定を実装
      - API Key環境変数の設定
      - CORS許可オリジンの設定
      - _要件: 9.1, 9.4_

    - [ ] 2.2.4 Lambda関数URLの設定を実装
      - AWS IAM認証の設定
      - CORS設定の強化（特定オリジンのみ許可）
      - 認証情報を含むリクエストの許可設定
      - _要件: 9.1, 9.4, 12.3_

  - [ ] 2.3 EventBridgeスタックを実装
    - フィード取得ジョブ（1時間ごと）
    - 記事削除ジョブ（1日1回）
    - _要件: 8.4, 12.2_

  - [ ] 2.4 フロントエンドスタックを実装
    - S3バケットとCloudFrontディストリビューションの設定
    - _要件: 12.2_

  - [ ] 2.5 CDKデプロイスクリプトを作成
    - 環境別デプロイの設定
    - _要件: 12.4, 12.5_

- [ ] 3. DynamoDBクライアントとデータモデルの実装
  - [ ] 3.1 データモデルクラスを実装
    - Feed、Article、Keyword、ImportanceReason、LinkIndexのPydanticモデルを作成
    - PK/SK/GSI生成メソッドを実装（GSI1～GSI5対応）
    - TTL設定メソッドを実装
    - 逆順ソートキー生成メソッドを実装（重要度スコア用）
    - デザインドキュメントのエンティティ設計に準拠
    - _要件: 8.5_

  - [ ] 3.2 DynamoDBクライアントクラスを実装
    - put_item、get_item、query、delete_item、batch_write_itemメソッドを実装
    - GSI1～GSI5を使用したクエリメソッドを実装
    - 時系列順・重要度順ソート用のクエリメソッドを実装
    - 効率的な削除クエリメソッドを実装（GSI3、GSI4使用）
    - カスケード削除用のクエリメソッドを実装（GSI5使用）
    - _要件: 8.5_

  - [ ] 3.3 データモデルのプロパティテストを作成
    - **プロパティ1: フィード登録の永続化**
    - **検証: 要件 1.1**
    - PK/SK生成の一意性テスト
    - GSI生成の正確性テスト

  - [ ] 3.4 データモデルのユニットテストを作成
    - 各エンティティのPydanticバリデーションテスト
    - PK/SK生成メソッドのテスト
    - TTL設定のテスト
    - 逆順ソートキー生成のテスト
    - _要件: 8.5_

  - [ ] 3.5 DynamoDBクライアントのユニットテストを作成
    - 基本的なCRUD操作のテスト
    - GSIクエリのテスト
    - エラーハンドリングのテスト
    - バッチ操作のテスト
    - _要件: 8.5_

- [ ] 4. フィード管理機能の実装
  - [ ] 4.1 FeedServiceクラスを実装
    - add_feed、get_feeds、delete_feed、update_feedメソッドを実装
    - _要件: 1.1, 1.2, 1.3, 1.4_

  - [ ] 4.2 フィード管理のプロパティテストを作成
    - **プロパティ2: フィード削除時のカスケード削除**
    - **検証: 要件 1.2**
    - **プロパティ3: フォルダ分類の保持**
    - **検証: 要件 1.3**
    - **プロパティ4: フィード一覧の完全性**
    - **検証: 要件 1.4**

  - [ ] 4.3 フィード管理のユニットテストを作成
    - 正常系のテスト
    - エッジケースのテスト
    - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 5. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 6. AWS Bedrockセマンティック検索の実装
  - [ ] 6.1 ImportanceScoreServiceクラスを実装
    - AWS Bedrockクライアントを初期化
    - invoke_bedrock_embeddings、get_embedding、calculate_similarity、calculate_scoreメソッドを実装
    - キーワード埋め込みのキャッシュ機能を実装
    - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

  - [ ] 6.2 重要度スコア計算のプロパティテストを作成
    - **プロパティ20: 重要度スコアの計算**
    - **検証: 要件 7.1**
    - **プロパティ21: スコア計算の加算性**
    - **検証: 要件 7.2**
    - **プロパティ22: 重要度理由の記録**
    - **検証: 要件 7.3, 7.4**

  - [ ] 6.3 重要度スコア計算のユニットテストを作成
    - Bedrockモックを使用したテスト
    - エラーハンドリングのテスト
    - _要件: 7.1, 7.2, 7.3_

- [ ] 7. RSSフィード取得機能の実装
  - [ ] 7.1 FeedFetcherServiceクラスを実装
    - feedparserを使用してRSSフィードをパース
    - fetch_all_feeds、fetch_feed、parse_feed、save_articlesメソッドを実装
    - ImportanceScoreServiceを使用して重要度スコアを計算
    - _要件: 2.1, 2.2, 2.3, 2.4, 2.5, 10.1_

  - [ ] 7.2 フィード取得のプロパティテストを作成
    - **プロパティ5: フィード取得エラーのハンドリング**
    - **検証: 要件 2.2**
    - **プロパティ6: 記事の冪等性**
    - **検証: 要件 2.3, 2.4**
    - **プロパティ7: 新規記事の未読状態**
    - **検証: 要件 2.5**

  - [ ] 7.3 フィード取得のユニットテストを作成
    - RSS 2.0とAtomフィードのパーステスト
    - エラーハンドリングのテスト
    - ImportanceScoreServiceとの統合テスト
    - _要件: 2.2, 10.1_

- [ ] 8. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 9. 記事管理機能の実装
  - [ ] 9.1 ArticleServiceクラスを実装
    - get_articles、get_article、mark_as_read、mark_as_savedメソッドを実装
    - DynamoDB GSIを使用した時系列順・重要度順のソート
    - _要件: 3.1, 3.2, 3.3, 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3_

  - [ ] 9.2 記事管理のプロパティテストを作成
    - **プロパティ8: 時系列順ソート**
    - **検証: 要件 3.1**
    - **プロパティ9: 重要度順ソート**
    - **検証: 要件 3.2**
    - **プロパティ10: 記事一覧の必須情報**
    - **検証: 要件 3.3**
    - **プロパティ11: 既読/未読の切り替え**
    - **検証: 要件 4.1, 4.2**
    - **プロパティ12: 未読記事フィルタ**
    - **検証: 要件 4.3**
    - **プロパティ13: 既読記事フィルタ**
    - **検証: 要件 4.4**
    - **プロパティ14: 記事保存の切り替え**
    - **検証: 要件 5.1, 5.2**
    - **プロパティ15: 保存記事フィルタ**
    - **検証: 要件 5.3**

  - [ ] 9.3 記事管理のユニットテストを作成
    - ソート機能のテスト
    - フィルタ機能のテスト
    - _要件: 3.1, 3.2, 4.3, 4.4, 5.3_

- [ ] 10. キーワード管理機能の実装
  - [ ] 10.1 KeywordServiceクラスを実装
    - add_keyword、get_keywords、update_keyword、delete_keyword、recalculate_all_scoresメソッドを実装
    - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 7.5_

  - [ ] 10.2 キーワード管理のプロパティテストを作成
    - **プロパティ16: キーワード登録の永続化**
    - **検証: 要件 6.1**
    - **プロパティ17: キーワードの重み設定**
    - **検証: 要件 6.2**
    - **プロパティ18: キーワードの有効化/無効化**
    - **検証: 要件 6.4, 6.5**
    - **プロパティ19: キーワード一覧の完全性**
    - **検証: 要件 6.6**
    - **プロパティ23: 重要度スコアの再計算**
    - **検証: 要件 7.5**

  - [ ] 10.3 キーワード管理のユニットテストを作成
    - デフォルト重みのテスト
    - 再計算機能のテスト
    - _要件: 6.3, 7.5_

- [ ] 11. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 12. 記事削除機能の実装
  - [ ] 12.1 CleanupServiceクラスを実装
    - cleanup_old_articles、delete_articles_by_age、delete_read_articlesメソッドを実装
    - _要件: 11.1, 11.2, 11.3, 11.4_

  - [ ] 12.2 記事削除のプロパティテストを作成
    - **プロパティ24: 古い記事の削除**
    - **検証: 要件 11.1**
    - **プロパティ25: 既読記事の削除**
    - **検証: 要件 11.2**
    - **プロパティ26: 記事削除時のカスケード削除**
    - **検証: 要件 11.4**

  - [ ] 12.3 記事削除のユニットテストを作成
    - 削除条件のテスト
    - カスケード削除のテスト
    - _要件: 11.1, 11.2, 11.4_

- [ ] 13. FastAPI エンドポイントと認証の実装
  - [ ] 13.1 API Key認証ミドルウェアを実装
    - [ ] 13.1.1 HTTPBearer認証スキームの設定
      - FastAPIセキュリティスキームの定義
      - verify_api_key関数の実装
      - _要件: 9.1_

    - [ ] 13.1.2 セキュリティミドルウェアの実装
      - セキュリティヘッダーミドルウェアの追加
      - 機密情報マスキングログフィルターの実装
      - _要件: 9.2, 9.5_

    - [ ] 13.1.3 レート制限ミドルウェアの実装
      - クライアント別レート制限の実装
      - レート制限超過時のエラーレスポンス
      - _要件: 9.3_

  - [ ] 13.2 CORS設定とセキュリティ強化を実装
    - 特定オリジンのみ許可するCORS設定
    - 機密情報マスキングログフィルターの実装
    - 入力検証とサニタイゼーションの追加
    - _要件: 9.4, 9.5_

  - [ ] 13.3 フィード管理エンドポイントを実装
    - POST /api/feeds、GET /api/feeds、DELETE /api/feeds/{feed_id}、PUT /api/feeds/{feed_id}
    - API Key認証を全エンドポイントに適用
    - _要件: 1.1, 1.2, 1.4, 9.1_

  - [ ] 13.4 記事管理エンドポイントを実装
    - GET /api/articles、GET /api/articles/{article_id}、PUT /api/articles/{article_id}/read、PUT /api/articles/{article_id}/save
    - API Key認証を全エンドポイントに適用
    - _要件: 3.1, 3.2, 4.1, 4.2, 5.1, 5.2, 9.1_

  - [ ] 13.5 キーワード管理エンドポイントを実装
    - POST /api/keywords、GET /api/keywords、PUT /api/keywords/{keyword_id}、DELETE /api/keywords/{keyword_id}、POST /api/keywords/recalculate
    - API Key認証を全エンドポイントに適用
    - _要件: 6.1, 6.4, 6.5, 6.6, 7.5, 9.1_

  - [ ] 13.6 ジョブ実行エンドポイントを実装
    - POST /api/jobs/fetch-feeds、POST /api/jobs/cleanup-articles
    - API Key認証を全エンドポイントに適用
    - _要件: 2.1, 11.3, 9.1_

  - [ ] 13.7 認証機能のプロパティテストを作成
    - **プロパティ31: API Key認証の検証**
    - **検証: 要件 9.1**
    - **プロパティ32: 認証失敗時のエラーレスポンス**
    - **検証: 要件 9.2**

  - [ ] 13.8 認証機能のユニットテストを作成
    - 有効なAPI Keyでのアクセステスト
    - 無効なAPI Keyでの認証失敗テスト
    - レート制限のテスト
    - _要件: 9.1, 9.2, 9.3_

  - [ ] 13.9 APIエンドポイントの統合テストを作成
    - 認証ありでのエンドツーエンドテスト
    - エラーレスポンスのテスト
    - セキュリティヘッダーの検証
    - _要件: 1.1, 3.1, 6.1, 9.1, 9.4_

- [ ] 14. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 15. Lambda関数とEventBridgeの設定
  - [ ] 15.1 Lambda関数のエントリーポイントを作成
    - FastAPIアプリケーションを起動するmain.pyを作成
    - _要件: 8.2, 8.3_

  - [ ] 15.2 Dockerfileを完成させる
    - AWS Lambda Web Adapterの設定
    - uvを使用した依存関係管理の設定
    - 認証関連の環境変数の設定
    - セキュリティ強化の設定
    - _要件: 8.2, 9.1_

- [ ] 16. フロントエンドの実装
  - [ ] 16.1 認証対応APIクライアントを実装
    - axios を使用してバックエンドAPIと通信
    - API Key認証ヘッダーの自動追加
    - 認証エラーハンドリングの実装
    - 環境変数でのAPI Key管理
    - _要件: 8.7, 9.1, 9.2_

  - [ ] 16.2 エラーバウンダリーコンポーネントを実装
    - 認証エラー用のErrorBoundaryコンポーネント
    - ユーザーフレンドリーなエラーメッセージ表示
    - _要件: 9.2_

  - [ ] 16.3 TanStack Queryフックを実装
    - useFeed、useArticles、useKeywordsフックを作成
    - 認証エラー時のリトライ処理
    - _要件: 8.9, 9.2_

  - [ ] 16.4 フィード管理コンポーネントを実装
    - FeedList、FeedFormコンポーネントを作成
    - Chakra UIを使用したUIデザイン
    - 認証エラー時の適切な表示
    - _要件: 1.1, 1.2, 1.4, 9.2_

  - [ ] 16.5 記事一覧コンポーネントを実装
    - [ ] 16.5.1 ArticleListコンポーネントの基本実装
      - TanStack TableとChakra UIを使用したテーブル表示
      - 基本的な記事情報の表示（タイトル、公開日時、フィード名）
      - _要件: 3.3_

    - [ ] 16.5.2 ソート機能の実装
      - 時系列順・重要度順の切り替えUI
      - ソート状態の管理
      - APIクエリパラメータとの連携
      - _要件: 3.1, 3.2_

    - [ ] 16.5.3 フィルタ機能の実装
      - 未読/既読、保存フィルタのUI
      - フィルタ状態の管理
      - APIクエリパラメータとの連携
      - _要件: 4.3, 4.4, 5.3_

    - [ ] 16.5.4 記事状態表示と操作ボタンの実装
      - 未読/既読状態、重要度スコアの表示
      - 既読/未読切り替えボタン
      - 保存/解除ボタン
      - _要件: 3.3, 4.1, 4.2, 5.1, 5.2_

  - [ ] 16.6 記事詳細コンポーネントを実装
    - ArticleDetailコンポーネントを作成
    - Chakra UIを使用したレスポンシブデザイン
    - 既読/未読、保存/解除ボタン
    - 重要度スコアと理由の表示
    - _要件: 4.1, 4.2, 5.1, 5.2, 7.3_

  - [ ] 16.7 キーワード管理コンポーネントを実装
    - KeywordList、KeywordFormコンポーネントを作成
    - Chakra UIを使用したフォームデザイン
    - _要件: 6.1, 6.2, 6.4, 6.5, 6.6_

  - [ ] 16.8 フロントエンド認証のユニットテストを作成
    - APIクライアントの認証テスト
    - エラーバウンダリーのテスト
    - 認証失敗時のコンポーネント動作テスト
    - _要件: 8.7, 8.8, 9.1, 9.2_

  - [ ] 16.9 フロントエンドのユニットテストを作成
    - コンポーネントのレンダリングテスト
    - ユーザーインタラクションのテスト
    - Chakra UIコンポーネントのテスト
    - _要件: 8.7, 8.8_

- [ ] 17. チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

- [ ] 18. CI/CDパイプラインの実装
  - [ ] 18.1 GitHub Actionsワークフローファイルを作成
    - [ ] 18.1.1 CI基本ワークフロー（ci.yml）を作成
      - プッシュ・プルリクエストトリガーの設定
      - 基本的なジョブ構造の定義
      - _要件: 13.1, 13.2_

    - [ ] 18.1.2 バックエンドテストジョブを実装
      - Python環境のセットアップ
      - リンティング、型チェック、テストの自動実行
      - カバレッジレポートの生成
      - _要件: 13.4, 13.5_

    - [ ] 18.1.3 フロントエンドテストジョブを実装
      - Node.js環境のセットアップ
      - リンティング、型チェック、テストの自動実行
      - ビルドテストの実行
      - _要件: 13.4_

    - [ ] 18.1.4 インフラストラクチャテストジョブを実装
      - CDK synthとdiffの実行
      - インフラストラクチャの検証
      - _要件: 13.4_

  - [ ] 18.2 バックエンドデプロイメントワークフローを作成
    - deploy-backend.ymlを作成
    - Docker イメージのビルドとECRへのプッシュ
    - Lambda関数の更新
    - _要件: 13.6, 13.7_

  - [ ] 18.3 フロントエンドデプロイメントワークフローを作成
    - deploy-frontend.ymlを作成
    - ビルドとS3へのデプロイ
    - CloudFrontキャッシュの無効化
    - _要件: 13.6, 13.7_

  - [ ] 18.4 インフラストラクチャデプロイメントワークフローを作成
    - deploy-infra.ymlを作成
    - CDKを使用したインフラストラクチャの自動デプロイ
    - _要件: 13.6, 13.7_

  - [ ] 18.5 CI/CDパイプラインのプロパティテストを作成
    - **プロパティ27: CI/CDパイプラインの品質ゲート**
    - **検証: 要件 13.3**
    - **プロパティ28: 自動デプロイメントの実行**
    - **検証: 要件 13.6**
    - **プロパティ29: テストカバレッジの維持**
    - **検証: 要件 13.5**
    - **プロパティ30: デプロイメント失敗時の通知**
    - **検証: 要件 13.10**

  - [ ] 18.6 GitHub Secretsとセキュリティ設定
    - AWS認証情報の設定
    - API Key（RSS_READER_API_KEY、VITE_API_KEY）の設定
    - 環境変数の設定
    - IAMポリシーの作成
    - 強力なAPI Key生成の実装
    - _要件: 9.1, 9.6, 13.11_

  - [ ] 18.7 セキュリティ強化されたデプロイメント設定
    - Parameter Storeでの機密情報暗号化
    - デプロイ時のAPI Key環境変数設定
    - 認証テストの追加
    - _要件: 9.1, 9.6, 13.7_

  - [ ] 18.8 統合テストとヘルスチェックの実装
    - デプロイメント後のヘルスチェック
    - 認証ありでの統合テストの自動実行
    - API Key認証の検証テスト
    - _要件: 9.1, 13.8, 13.9_

  - [ ] 18.9 通知システムの設定
    - Slackまたは他の通知システムとの連携
    - デプロイメント成功/失敗の通知
    - セキュリティアラートの設定
    - _要件: 9.7, 13.12_

- [ ] 19. デプロイメント設定
  - [ ] 19.1 CDKデプロイメントの実行
    - 開発環境へのデプロイ
    - _要件: 12.4, 12.5_

  - [ ] 19.2 フロントエンドのデプロイスクリプトを作成
    - ビルドとS3へのアップロード
    - CloudFrontキャッシュの無効化
    - _要件: 8.7_

- [ ] 20. 最終チェックポイント - すべてのテストが通過することを確認
  - すべてのテストが通過することを確認し、質問があればユーザーに尋ねる

## 注意事項

- 各タスクは特定の要件を参照しており、トレーサビリティを確保しています
- チェックポイントタスクで段階的な検証を行い、問題を早期に発見します
- プロパティテストは普遍的な正確性を検証し、ユニットテストは特定の例とエッジケースを検証します
- すべてのテストタスクが必須となっており、包括的なテストカバレッジを確保します
- AWS CDKを使用してインフラストラクチャをコードで管理し、環境の再現性を確保します
- GitHub Actionsを使用したCI/CDパイプラインにより、コード品質の保証と自動デプロイメントを実現します
